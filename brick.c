
#include <stdio.h>
#include "include.h"

struct background square[ROW+1][COLUMN+1];
char block_ID;		//方块的序号
char next_block_ID;		//保存下一个方块的编号
extern struct brick graph[19];
extern int score;
//获取下一个要显示图形的ID
void get_block_ID()
{
	int i, j;
	//下一个出现图形的ID
	next_block_ID = random()%19;		
	printf("\033[%d;%dH\033[0mNEXT", 3, COLUMN+10);
	//将原来这个位置上的图形清空
	for(i = 0; i < 4; i++)
	{
		for(j = 0; j < 8; j++)
		{
			printf("\033[%d;%dH", 4+i, COLUMN+10+j);
			printf("\033[0m ");
		}
	}
	//显示一个图形
	for(i = 0; i < 4; i++)
	{
		for(j = 0; j < 8; j++)
		{
			//到屏幕的位置
			printf("\033[%d;%dH", 4+i, COLUMN+10+j);
			//显示出来方块
			if(graph[next_block_ID].blocks[i][j])
			{
				//显示不同的颜色
				printf("\033[%dm ",graph[next_block_ID].color);
			}
		}
	}
	fflush(NULL);
}
//外框初始化
void square_init(void)
{
    int x, y;
	printf("\033[2J");
	printf("\033[1;1H");
	printf("\033[0m");
	//show frame
    for(y = 1; y < ROW+1; y++)
    {
        for(x = 1; x < COLUMN+1; x++)
        {
            if((y == 1) || (y == ROW) || (x == 1) || (x == COLUMN))
            {
                printf("\033[44m ");
                square[y][x].val = 1;
                square[y][x].color = blue;
            }
            else
            {
                printf("\033[0m ");
                square[y][x].val = 0; 
                square[y][x].color = close; 
            }
        }
		printf("\n");
    }
	//show SCORE
	printf("\033[%d;%dH\033[0mSCORE", 12, COLUMN+10);
	//show socore
	printf("\033[%d;%dH%03d", 13, COLUMN+11, score);
	printf("\n");
}


struct brick graph[19] = {
   	{	//L 
        {0,0,0,0,0,0,0,0,
         1,1,0,0,0,0,0,0,
         1,1,0,0,0,0,0,0,
         1,1,1,1,0,0,0,0},red,0
   	},
   	{
        {0,0,0,0,0,0,0,0,
         0,0,0,0,0,0,0,0,
         1,1,1,1,1,1,0,0,
         1,1,0,0,0,0,0,0},red,1 
   	},
	{
        {0,0,0,0,0,0,0,0,
         1,1,1,1,0,0,0,0,
         0,0,1,1,0,0,0,0,
         0,0,1,1,0,0,0,0},red,2
   	},
	{
        {0,0,0,0,0,0,0,0,
         0,0,0,0,0,0,0,0,
         0,0,0,0,1,1,0,0,
         1,1,1,1,1,1,0,0},red,3
   	},
	{	//J
        {0,0,0,0,0,0,0,0,
         0,0,1,1,0,0,0,0,
         0,0,1,1,0,0,0,0,
         1,1,1,1,0,0,0,0},green,4
   	},
	{
        {0,0,0,0,0,0,0,0,
         0,0,0,0,0,0,0,0,
         1,1,0,0,0,0,0,0,
         1,1,1,1,1,1,0,0},green,5
   	},
	{
        {0,0,0,0,0,0,0,0,
         1,1,1,1,0,0,0,0,
         1,1,0,0,0,0,0,0,
         1,1,0,0,0,0,0,0},green,6
   	},
	{
        {0,0,0,0,0,0,0,0,
         0,0,0,0,0,0,0,0,
         1,1,1,1,1,1,0,0,
         0,0,0,0,1,1,0,0},green,7
   	},
	{	//T
        {0,0,0,0,0,0,0,0,
         0,0,0,0,0,0,0,0,
         0,0,1,1,0,0,0,0,
         1,1,1,1,1,1,0,0},yellow,8
   	},
	{
        {0,0,0,0,0,0,0,0,
         1,1,0,0,0,0,0,0,
         1,1,1,1,0,0,0,0,
         1,1,0,0,0,0,0,0},yellow,9
   	},
	{
        {0,0,0,0,0,0,0,0,
         0,0,0,0,0,0,0,0,
         1,1,1,1,1,1,0,0,
         0,0,1,1,0,0,0,0},yellow,10
   	},
	{
        {0,0,0,0,0,0,0,0,
         0,0,1,1,0,0,0,0,
         1,1,1,1,0,0,0,0,
         0,0,1,1,0,0,0,0},yellow,11
   	},
	{	//Z
        {0,0,0,0,0,0,0,0,
         0,0,0,0,0,0,0,0,
         1,1,1,1,0,0,0,0,
         0,0,1,1,1,1,0,0},blue,12
   	},
	{
        {0,0,0,0,0,0,0,0,
         0,0,0,0,1,1,0,0,
         0,0,1,1,1,1,0,0,
         0,0,1,1,0,0,0,0},blue,13
   	},
	{	//I
        {0,0,1,1,0,0,0,0,
         0,0,1,1,0,0,0,0,
         0,0,1,1,0,0,0,0,
         0,0,1,1,0,0,0,0},purple,14
   	},
	{
        {0,0,0,0,0,0,0,0,
         0,0,0,0,0,0,0,0,
         0,0,0,0,0,0,0,0,
         1,1,1,1,1,1,1,1},purple,15
   	},
	{	//S
        {0,0,0,0,0,0,0,0,
         0,0,0,0,0,0,0,0,
         0,0,1,1,1,1,0,0,
         1,1,1,1,0,0,0,0},dark_green,16
   	},
	{
        {0,0,0,0,0,0,0,0,
         0,0,1,1,0,0,0,0,
         0,0,1,1,1,1,0,0,
         0,0,0,0,1,1,0,0},dark_green,17
   	},
	{	//O
        {0,0,0,0,0,0,0,0,
         0,0,0,0,0,0,0,0,
         1,1,1,1,0,0,0,0,
         1,1,1,1,0,0,0,0},red,18
   	},

};
